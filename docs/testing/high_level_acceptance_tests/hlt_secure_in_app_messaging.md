# High-Level Acceptance Test: Secure In-App Messaging

**Test ID:** HLT-005
**Test Title/Objective:** Verify that users, authenticated via Supastarter, can securely send and receive messages for Neighborly Skillshare, view message history, and receive real-time notifications.
**Priority:** High
**Version:** 1.1 (Revised for Supastarter Template Integration)
**References:**
*   [`init_docs/blueprint.md (Section 3.1)`](../../../init_docs/blueprint.md#L34)
*   [`init_docs/product_requirements.md (Sections 2.2.4, 4.2.4)`](../../../init_docs/product_requirements.md#L155)
*   [`docs/research/high_level_test_strategy_report.md (Sections 3.4, 8.2)`](../../research/high_level_test_strategy_report.md#L64)
*   [`docs/research/github_template_research_report.md`](../../research/github_template_research_report.md)
*   [`docs/template_integration_guide.md`](../../template_integration_guide.md)

## 1. Preconditions
*   The Neighborly Skillshare MVP web application, built upon Supastarter, is deployed and accessible.
*   Two test users are registered via Supastarter, email verified, logged in, and have completed Neighborly Skillshare profiles:
    *   User A: "James (Skill Seeker)" (`james_newuser_supastarter_email@example.com`, `Password123!`). James has a skill request.
    *   User B: "Tom Fixit (Skill Provider)" (`tom_fixit_supastarter@example.com`, `PasswordTom123!`). Tom has a skill offer.
*   Supabase Realtime subscriptions for messaging (custom `messages`, `conversations` tables) are configured and functional as per [`docs/template_integration_guide.md`](../../template_integration_guide.md).
*   Ideally, run with two separate browser instances/sessions.

## 2. Test Steps

| Step | Action (User A: James)                                                                                    | Expected Result (User A: James)                                                                                                | Action (User B: Tom Fixit)                                                                                                | Expected Result (User B: Tom Fixit)                                                                                                                              | AI Verifiable Completion Criterion (Combined)                                                                                                                                                                                                                                                           |
| :--- | :-------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------ | :--------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1    | Log in as James. Navigate to Tom Fixit's profile page or his "Minor Home Repairs" skill offer page.       | Tom's profile/offer page is displayed. A "Send Message" or "Contact Tom" button is visible (custom Neighborly Skillshare UI).        | Log in as Tom Fixit in a separate browser/session. Navigate to his Neighborly Skillshare dashboard or messages page.      | Tom is logged in. His dashboard or an empty messages page (if no prior messages) is shown.                                                                       | AI (James): Verify "Send Message" button present. AI (Tom): Verify Tom is logged in.                                                                                                                                                                                                    |
| 2    | Click the "Send Message" button to initiate a conversation with Tom.                                      | A messaging interface/modal opens (custom UI), ready for James to type a message to Tom. Recipient is Tom Fixit.                 | (Waits for message)                                                                                                       | (Waits for message)                                                                                                                                              | AI (James): Verify messaging UI opens, recipient is "Tom Fixit". Database: A new record in `conversations` table might be created linking James and Tom.                                                                                                                                   |
| 3    | Type message: "Hi Tom, I saw your offer for Minor Home Repairs. I need help with a leaky faucet. Are you available next week?" and click "Send". | Message "Hi Tom..." is sent and appears in James's view of the conversation history with Tom (custom UI).                                | (Observes notifications/messages page)                                                                                    | Tom receives an in-app notification (custom UI). The messages page/list updates to show a new unread message from James.                                       | AI (James): Verify sent message appears in James's chat UI. Database: Message record created in `messages` table (linked to conversation, sender James, receiver Tom) with content. AI (Tom): Verify notification. Verify new message from James in Tom's message list with "unread" status. |
| 4    | (Waits for reply)                                                                                         | (Waits for reply)                                                                                                                | Navigate to the conversation with James. The message "Hi Tom..." is visible.                                              | Message from James is correctly displayed.                                                                                                                       | AI (Tom): Verify James's message content is correctly displayed.                                                                                                                                                                                                                          |
| 5    | (Waits for reply)                                                                                         | (Waits for reply)                                                                                                                | Type reply: "Hi James, thanks for reaching out. Yes, I can help with that. How about Tuesday afternoon?" and click "Send". | Message "Hi James..." is sent and appears in Tom's view of the conversation history.                                                                         | AI (Tom): Verify sent message in Tom's chat UI. Database: Message record created in `messages` from Tom to James.                                                                                                                                                                    |
| 6    | (Observes notifications/messages page)                                                                    | James receives an in-app notification. Conversation with Tom updates with the new unread message.                                | (Waits)                                                                                                                   | (Waits)                                                                                                                                                          | AI (James): Verify notification. Verify new message from Tom in James's message list/UI with "unread" status and correct content.                                                                                                                                                 |
| 7    | Navigate to the conversation with Tom.                                                                    | Tom's reply "Hi James..." is visible.                                                                                            | (Remains on messages page or dashboard)                                                                                   | (No change)                                                                                                                                                      | AI (James): Verify Tom's message content is correctly displayed.                                                                                                                                                                                                                          |
| 8    | Send another message: "Tuesday afternoon works for me! What time?" and click "Send".                      | Message sent and appears in history.                                                                                             | (Observes notifications/messages page)                                                                                    | Tom receives another notification and the new message from James.                                                                                                | AI: Verify message flow continues. Database: New message record in `messages`.                                                                                                                                                                                                         |
| 9    | Navigate to the main "Messages" or "Inbox" page (custom Neighborly Skillshare UI).                        | List of conversations displayed. Conversation with Tom Fixit is present, showing snippet and unread indicator if Tom replied.    | Navigate to the main "Messages" or "Inbox" page.                                                                          | List of conversations displayed. Conversation with James is present, showing snippet.                                                                              | AI (James & Tom): Verify conversation list. Verify conversation between James and Tom is listed for both.                                                                                                                                                                                  |
| 10   | **Report Message (Optional):** From conversation, James finds option to report one of Tom's messages.       | Report option available. James submits report. Confirmation message appears.                                                     | (No direct interaction)                                                                                                   | (No direct interaction)                                                                                                                                          | AI (James): Verify "Report message" option. Confirmation "Message reported" displayed. Database: Record created in `reports` table linked to message and user.                                                                                                                            |

## 3. Test Data
*   **User A (Seeker):** James (`james_newuser_supastarter_email@example.com`)
*   **User B (Provider):** Tom Fixit (`tom_fixit_supastarter_email@example.com`)
*   Messages as per steps.

## 4. Expected Overall Result
Users can securely message. Notifications are real-time via Supabase. History is maintained in custom `messages` and `conversations` tables. Reporting is functional.

## 5. AI Verifiable End Result
*   Message records between James and Tom exist in `messages` table with correct sender, receiver (IDs from `auth.users`), content, and timestamps, linked to a `conversations` record.
*   Both UIs correctly display messages.
*   In-app notifications are triggered.
*   Main messages/inbox page lists the conversation.
*   If reported, `reports` record created.
*   AI verifies via UI text, notification cues, and database checks in `messages`, `conversations`, `reports` tables.